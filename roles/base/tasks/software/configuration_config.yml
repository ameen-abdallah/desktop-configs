- name: System configuration | core packages | monitor configuration
  ansible.builtin.lineinfile:
    path: '/home/{{ username_on_the_host.stdout }}/.config/hypr/hyprland.conf'
    regex: 'monitor=,preferred,auto,auto'
    line: |-
      monitor=DP-1,1920x1080@60,0x0,1
      monitor=HDMI-A-1,1920x1080@60,1920x0,1
    state: present

- name: System configuration | core packages | primary applications
  ansible.builtin.lineinfile:
    path: '/home/{{ username_on_the_host.stdout }}/.config/hypr/hyprland.conf'    
    regex: "{{ item.regex }}"
    line: "{{ item.line }}"
    state: present
  loop:
    - line: '$terminal = ghostty'
      regex: "\\$terminal = kitty"
    - line: '$fileManager = dolphin'
      regex: "\\$fileManager = dolphin"
    - line: '$browser = brave'
      regex: "\\$menu = wofi"

- name: System configuration | core packages | primary applications
  ansible.builtin.lineinfile:
    path: '/home/{{ username_on_the_host.stdout }}/.config/hypr/hyprland.conf'
    line: "{{ item.line }}"
    insertafter: "\\$browser = brave"
    state: present
  loop:
    - line: '$menu = fuzzel'
    - line: '$editor = code'

- name: Enable sddm
  become: true
  ansible.builtin.systemd:
    name: sddm.service
    enabled: true

- name: Set Fish as the default shell for the user
  ansible.builtin.user:
    name: '{{ username_on_the_host.stdout }}'
    shell: /usr/bin/fish
  become: true

- name: Insert a block of text before a specific pattern
  ansible.builtin.blockinfile:
    path: '/home/{{ username_on_the_host.stdout }}/.config/hypr/hyprland.conf'
    block: |
      exec-once=/usr/lib/polkit-kde-authentication-agent-1 # Polkit for privilege management      insertbefore: 'env = XCURSOR_SIZE,24'
      exec-once=/usr/bin/dunst
      exec-once=waybar
    marker: '# {mark} Exec once | ANSIBLE MANAGED BLOCK'
    prepend_newline: true
    insertafter: "# exec-once = waybar \\& hyprpaper \\& firefox"
    state: present

- name: Insert a block of text before a specific pattern
  ansible.builtin.blockinfile:
    path: '/home/{{ username_on_the_host.stdout }}/.config/hypr/hyprland.conf'
    block: |
      # QT
      env = QT_QPA_PLATFORM,wayland;xcb
      env = QT_QPA_PLATFORMTHEME,qt6ct
      env = QT_WAYLAND_DISABLE_WINDOWDECORATION,1
      env = QT_AUTO_SCREEN_SCALE_FACTOR,1
      env = QT_STYLE_OVERRIDE,kvantum

      # Toolkit Backend Variables
      env = GDK_BACKEND,wayland,x11,*
      env = SDL_VIDEODRIVER,wayland
      env = CLUTTER_BACKEND,wayland

      # XDG Specifications
      env = XDG_CURRENT_DESKTOP,Hyprland
      env = XDG_SESSION_TYPE,wayland
      env = XDG_SESSION_DESKTOP,Hyprland
    marker: '# {mark} Environment Variable | ANSIBLE MANAGED BLOCK'
    prepend_newline: true
    insertafter: 'env = HYPRCURSOR_SIZE,24'
    state: present

- name: System configuration | core packages | primary applications
  ansible.builtin.lineinfile:
    path: '/home/{{ username_on_the_host.stdout }}/.config/hypr/hyprland.conf'    
    insertafter: '# Example binds'
    line: "{{ item.line }}"
    state: present
  loop:
    - line: 'bind = $mainMod, RETURN, exec, $terminal'
    - line: 'bind = $mainMod, B, exec, $browser'
    - line: 'bind = $mainMod, A, exec, $menu'
    - line: 'bind = Ctrl, Escape, exec, killall waybar || waybar'


- name: System configuration | core packages | primary applications
  ansible.builtin.lineinfile:
    path: '/home/{{ username_on_the_host.stdout }}/.config/hypr/hyprland.conf'    
    regex: "{{ item.regex }}"
    line: "{{ item.line }}"
    state: present
  loop:
    - line: 'bind = $mainMod, M, fullscreen, 1'
      regex: "bind = \\$mainMod, M, exit,"
    - line: 'bind = $mainMod, Q, killactive,'
      regex: "bind = \\$mainMod, Q, exec, \\$terminal"
    - line: 'bind = $mainMod, V, exec, code'
      regex: "bind = \\$mainMod, V, togglefloating,,"

- name: System configuration | core packages | primary applications
  ansible.builtin.lineinfile:
    path: '/home/{{ username_on_the_host.stdout }}/.config/hypr/hyprland.conf'
    regex: 'kb_layout = us'
    line: 'kb_layout = dk'
    state: present

- name: System configuration | core packages | primary applications
  ansible.builtin.lineinfile:
    path: '/home/{{ username_on_the_host.stdout }}/.config/hypr/hyprland.conf'
    regex: 'natural_scroll = false'
    line: 'natural_scroll = true'
    state: present

- name: System configuration | core packages | primary applications
  ansible.builtin.lineinfile:
    path: '/home/{{ username_on_the_host.stdout }}/.config/hypr/hyprland.conf'
    regex: 'workspace_swipe = false'
    line: 'workspace_swipe = true'
    state: present


